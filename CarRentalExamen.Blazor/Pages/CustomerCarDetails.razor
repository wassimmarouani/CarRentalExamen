@page "/cars/{id:int}"
@attribute [Authorize]
@inject ApiClient Api
@inject NavigationManager Navigation

<PageTitle>@(car != null ? $"{car.Make} {car.Model}" : "Car Details")</PageTitle>

<div class="customer-car-details">
    @if (isLoading)
    {
        <div class="d-flex justify-content-center align-items-center py-5">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
        </div>
    }
    else if (car is null)
    {
        <div class="container py-5">
            <div class="alert alert-warning text-center">
                <h5>Car Not Found</h5>
                <p class="mb-3">The car you're looking for doesn't exist or has been removed.</p>
                <button class="btn btn-primary" @onclick='() => Navigation.NavigateTo("/customer")'>
                    Browse Available Cars
                </button>
            </div>
        </div>
    }
    else
    {
        <div class="car-detail-hero">
            <div class="container">
                <nav class="breadcrumb-nav">
                    <a href="/customer">Cars</a>
                    <span class="separator">/</span>
                    <span>@car.Make @car.Model</span>
                </nav>
            </div>
        </div>

        <div class="container py-4">
            <div class="row g-4">
                <!-- Image Section -->
                <div class="col-lg-7">
                    <div class="car-image-gallery">
                        <div class="main-image-container">
                            <img src="@HeroImageUrl" alt="@($"{car.Make} {car.Model}")" class="main-car-image" onerror="this.src='/favicon.png';" />
                            <span class="status-badge @GetStatusBadgeClass(car.Status)">@car.Status</span>
                        </div>
                    </div>
                </div>

                <!-- Details Section -->
                <div class="col-lg-5">
                    <div class="car-info-card">
                        <div class="car-title-section">
                            <h1 class="car-title">@car.Make @car.Model</h1>
                            <p class="car-year">@car.Year</p>
                        </div>

                        <div class="price-section">
                            <div class="price-tag">
                                <span class="price-amount">@car.DailyPrice.ToString("0.00") &euro;</span>
                                <span class="price-period">/ day</span>
                            </div>
                        </div>

                        <div class="specs-grid">
                            <div class="spec-item">
                                <div class="spec-icon">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M4 7a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v12a2 2 0 0 1 -2 2h-12a2 2 0 0 1 -2 -2v-12z"></path>
                                        <path d="M16 3v4"></path>
                                        <path d="M8 3v4"></path>
                                        <path d="M4 11h16"></path>
                                    </svg>
                                </div>
                                <div class="spec-details">
                                    <span class="spec-label">Year</span>
                                    <span class="spec-value">@car.Year</span>
                                </div>
                            </div>
                            <div class="spec-item">
                                <div class="spec-icon">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <circle cx="12" cy="12" r="10"></circle>
                                        <path d="M12 6v6l4 2"></path>
                                    </svg>
                                </div>
                                <div class="spec-details">
                                    <span class="spec-label">Mileage</span>
                                    <span class="spec-value">@car.Mileage.ToString("N0") km</span>
                                </div>
                            </div>
                            <div class="spec-item">
                                <div class="spec-icon">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <rect x="3" y="5" width="18" height="14" rx="2"></rect>
                                        <path d="M7 15h10"></path>
                                    </svg>
                                </div>
                                <div class="spec-details">
                                    <span class="spec-label">Plate</span>
                                    <span class="spec-value">@car.PlateNumber</span>
                                </div>
                            </div>
                            <div class="spec-item">
                                <div class="spec-icon">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M7 17m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0"></path>
                                        <path d="M17 17m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0"></path>
                                        <path d="M5 17h-2v-6l2 -5h9l4 5h1a2 2 0 0 1 2 2v4h-2m-4 0h-6m-6 -6h15m-6 0v-5"></path>
                                    </svg>
                                </div>
                                <div class="spec-details">
                                    <span class="spec-label">Make</span>
                                    <span class="spec-value">@car.Make</span>
                                </div>
                            </div>
                        </div>

                        <div class="action-section">
                            @if (car.Status == CarStatus.Available)
                            {
                                <button class="btn btn-primary btn-lg w-100" @onclick="ReserveCar">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M4 7a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v12a2 2 0 0 1 -2 2h-12a2 2 0 0 1 -2 -2v-12z"></path>
                                        <path d="M16 3v4"></path>
                                        <path d="M8 3v4"></path>
                                        <path d="M4 11h16"></path>
                                        <path d="M12 15l0 0.01"></path>
                                    </svg>
                                    Reserve Now
                                </button>
                            }
                            else
                            {
                                <div class="unavailable-notice">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M12 9v2m0 4v.01"></path>
                                        <path d="M5 19h14a2 2 0 0 0 1.84 -2.75l-7.1 -12.25a2 2 0 0 0 -3.5 0l-7.1 12.25a2 2 0 0 0 1.75 2.75"></path>
                                    </svg>
                                    <span>This car is currently @car.Status.ToString().ToLower()</span>
                                </div>
                            }
                            <button class="btn btn-outline-secondary w-100 mt-2" @onclick='() => Navigation.NavigateTo("/customer")'>
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M5 12h14"></path>
                                    <path d="M5 12l6 6"></path>
                                    <path d="M5 12l6 -6"></path>
                                </svg>
                                Back to Cars
                            </button>
                        </div>

                        <div class="info-notice">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"></circle>
                                <path d="M12 16v-4"></path>
                                <path d="M12 8h.01"></path>
                            </svg>
                            <span>Free cancellation up to 24 hours before pickup</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Additional Info Section -->
            <div class="row mt-4">
                <div class="col-12">
                    <div class="info-cards-row">
                        <div class="info-card">
                            <div class="info-card-icon">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M9 12l2 2l4 -4"></path>
                                    <path d="M12 3a12 12 0 0 0 8.5 3a12 12 0 0 1 -8.5 15a12 12 0 0 1 -8.5 -15a12 12 0 0 0 8.5 -3"></path>
                                </svg>
                            </div>
                            <div class="info-card-content">
                                <h6>Fully Insured</h6>
                                <p>Comprehensive coverage included</p>
                            </div>
                        </div>
                        <div class="info-card">
                            <div class="info-card-icon">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M12 12m-9 0a9 9 0 1 0 18 0a9 9 0 1 0 -18 0"></path>
                                    <path d="M12 8v4l2 2"></path>
                                </svg>
                            </div>
                            <div class="info-card-content">
                                <h6>24/7 Support</h6>
                                <p>Roadside assistance available</p>
                            </div>
                        </div>
                        <div class="info-card">
                            <div class="info-card-icon">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M3 12a9 9 0 1 0 18 0a9 9 0 0 0 -18 0"></path>
                                    <path d="M9 12l2 2l4 -4"></path>
                                </svg>
                            </div>
                            <div class="info-card-content">
                                <h6>Easy Booking</h6>
                                <p>Quick online reservation</p>
                            </div>
                        </div>
                        <div class="info-card">
                            <div class="info-card-icon">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M12 17.75l-6.172 3.245l1.179 -6.873l-5 -4.867l6.9 -1l3.086 -6.253l3.086 6.253l6.9 1l-5 4.867l1.179 6.873z"></path>
                                </svg>
                            </div>
                            <div class="info-card-content">
                                <h6>Top Rated</h6>
                                <p>Quality verified vehicles</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    }
</div>

<style>
    .customer-car-details {
        min-height: 100vh;
        background: var(--vf-bg-soft, #f8fafc);
    }

    .car-detail-hero {
        background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
        padding: 1rem 0;
    }

    .breadcrumb-nav {
        color: rgba(255, 255, 255, 0.7);
        font-size: 0.875rem;
    }

    .breadcrumb-nav a {
        color: rgba(255, 255, 255, 0.7);
        text-decoration: none;
    }

    .breadcrumb-nav a:hover {
        color: #fff;
    }

    .breadcrumb-nav .separator {
        margin: 0 0.5rem;
    }

    .car-image-gallery {
        background: #fff;
        border-radius: 1rem;
        overflow: hidden;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
    }

    .main-image-container {
        position: relative;
        aspect-ratio: 16 / 10;
        background: linear-gradient(135deg, #e2e8f0 0%, #f1f5f9 100%);
    }

    .main-car-image {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .status-badge {
        position: absolute;
        top: 1rem;
        right: 1rem;
        padding: 0.5rem 1rem;
        border-radius: 2rem;
        font-size: 0.75rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.05em;
    }

    .status-badge.available {
        background: #10b981;
        color: #fff;
    }

    .status-badge.reserved, .status-badge.rented {
        background: #f59e0b;
        color: #fff;
    }

    .status-badge.maintenance {
        background: #6b7280;
        color: #fff;
    }

    .car-info-card {
        background: #fff;
        border-radius: 1rem;
        padding: 1.5rem;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
    }

    .car-title-section {
        margin-bottom: 1rem;
        padding-bottom: 1rem;
        border-bottom: 1px solid #e2e8f0;
    }

    .car-title {
        font-size: 1.75rem;
        font-weight: 700;
        color: #1e293b;
        margin: 0;
    }

    .car-year {
        color: #64748b;
        font-size: 1rem;
        margin: 0.25rem 0 0;
    }

    .price-section {
        margin-bottom: 1.5rem;
    }

    .price-tag {
        display: flex;
        align-items: baseline;
        gap: 0.25rem;
    }

    .price-amount {
        font-size: 2rem;
        font-weight: 700;
        color: #0ea5e9;
    }

    .price-period {
        font-size: 1rem;
        color: #64748b;
    }

    .specs-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 1rem;
        margin-bottom: 1.5rem;
        padding-bottom: 1.5rem;
        border-bottom: 1px solid #e2e8f0;
    }

    .spec-item {
        display: flex;
        align-items: center;
        gap: 0.75rem;
    }

    .spec-icon {
        width: 40px;
        height: 40px;
        background: #f1f5f9;
        border-radius: 0.5rem;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #64748b;
    }

    .spec-details {
        display: flex;
        flex-direction: column;
    }

    .spec-label {
        font-size: 0.75rem;
        color: #94a3b8;
        text-transform: uppercase;
        letter-spacing: 0.05em;
    }

    .spec-value {
        font-weight: 600;
        color: #1e293b;
    }

    .action-section {
        margin-bottom: 1rem;
    }

    .action-section .btn {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
    }

    .unavailable-notice {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
        padding: 1rem;
        background: #fef3c7;
        border-radius: 0.5rem;
        color: #92400e;
        font-weight: 500;
    }

    .info-notice {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.75rem;
        background: #f0fdf4;
        border-radius: 0.5rem;
        color: #166534;
        font-size: 0.875rem;
    }

    .info-cards-row {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1rem;
    }

    .info-card {
        display: flex;
        align-items: flex-start;
        gap: 1rem;
        padding: 1.25rem;
        background: #fff;
        border-radius: 0.75rem;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }

    .info-card-icon {
        width: 48px;
        height: 48px;
        background: linear-gradient(135deg, #0ea5e9 0%, #0284c7 100%);
        border-radius: 0.75rem;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #fff;
        flex-shrink: 0;
    }

    .info-card-content h6 {
        margin: 0 0 0.25rem;
        font-weight: 600;
        color: #1e293b;
    }

    .info-card-content p {
        margin: 0;
        font-size: 0.875rem;
        color: #64748b;
    }

    @@media (max-width: 768px) {
        .specs-grid {
            grid-template-columns: 1fr;
        }

        .car-title {
            font-size: 1.5rem;
        }

        .price-amount {
            font-size: 1.5rem;
        }
    }
</style>

@code {
    [Parameter] public int id { get; set; }
    private Car? car;
    private bool isLoading = true;
    private string HeroImageUrl => BuildImageUrl(car?.ImageUrl);

    protected override async Task OnInitializedAsync()
    {
        await LoadCar();
    }

    private async Task LoadCar()
    {
        isLoading = true;
        car = await Api.GetCarAsync(id);
        isLoading = false;
    }

    private string BuildImageUrl(string? imageUrl)
    {
        if (string.IsNullOrWhiteSpace(imageUrl))
        {
            return "/favicon.png";
        }

        return imageUrl.StartsWith("http", StringComparison.OrdinalIgnoreCase)
            ? imageUrl
            : Navigation.ToAbsoluteUri(imageUrl).ToString();
    }

    private string GetStatusBadgeClass(CarStatus status) => status.ToString().ToLower();

    private void ReserveCar()
    {
        Navigation.NavigateTo($"/reserve/{id}");
    }
}
